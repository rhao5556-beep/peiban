# KnowMeBench è¯„æµ‹æ”¹è¿›æ–¹æ¡ˆ

åŸºäºè¯„æµ‹ç»“æœï¼ˆå¹³å‡åˆ† 3.29/5.0ï¼‰ï¼Œé’ˆå¯¹å¼±é¡¹ä»»åŠ¡æå‡ºç³»ç»Ÿæ€§æ”¹è¿›æ–¹æ¡ˆã€‚

## ğŸ“Š é—®é¢˜è¯Šæ–­

### ğŸ”´ é«˜ä¼˜å…ˆçº§é—®é¢˜ï¼ˆP0ï¼‰

#### 1. æ—¶é—´æ¨ç†èƒ½åŠ›å¼±ï¼ˆ1.67/5.0ï¼‰
**é—®é¢˜è¡¨ç°**ï¼š
- æ—¶é—´è®¡ç®—é”™è¯¯ï¼ˆç›¸å·® 1 åˆ†é’Ÿï¼‰
- æ—¶é—´é€»è¾‘æ¨ç†é”™è¯¯
- ç¼ºå°‘ç²¾ç¡®çš„æ—¶é—´ç»†èŠ‚ï¼ˆå¦‚ 10 ç§’ï¼‰

**æ ¹æœ¬åŸå› **ï¼š
- æ—¶é—´å®ä½“æå–ä¸å¤Ÿç²¾ç¡®
- ç¼ºå°‘ä¸“é—¨çš„æ—¶é—´è®¡ç®—æ¨¡å—
- LLM å¯¹æ—¶é—´æ¨ç†çš„ prompt ä¸å¤Ÿæ˜ç¡®

#### 2. æ·±å±‚å¿ƒç†åˆ†æä¸è¶³ï¼ˆ1.33/5.0ï¼‰
**é—®é¢˜è¡¨ç°**ï¼š
- æœªæä¾›ä»»ä½•æ´å¯Ÿï¼ˆ0 åˆ†ï¼‰
- åˆ†æè¿‡äºæ³›æ³›ï¼Œæœªè§¦åŠæ ¸å¿ƒåŠ¨æœº
- å¼•å…¥äº†å‚è€ƒç­”æ¡ˆä¸­æ²¡æœ‰çš„å…ƒç´ 

**æ ¹æœ¬åŸå› **ï¼š
- ç¼ºå°‘å¿ƒç†åˆ†æçš„ä¸“é—¨ prompt
- æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡å¯èƒ½ä¸å¤Ÿæ·±å…¥
- LLM å€¾å‘äºç»™å‡ºé€šç”¨å›ç­”è€Œéæ·±å±‚æ´å¯Ÿ

#### 3. å¶å°”ç¼–é€ ä¿¡æ¯ï¼ˆAdversarial Abstention: 3.33/5.0ï¼‰
**é—®é¢˜è¡¨ç°**ï¼š
- åœ¨ä¿¡æ¯ä¸è¶³æ—¶ç¼–é€ å…·ä½“ç»†èŠ‚
- æœªèƒ½æ˜ç¡®è¡¨ç¤º"ä¸çŸ¥é“"

**æ ¹æœ¬åŸå› **ï¼š
- ç¼ºå°‘"ä¿¡æ¯å……åˆ†æ€§"åˆ¤æ–­æœºåˆ¶
- LLM å€¾å‘äº"æœ‰é—®å¿…ç­”"è€Œéæ‰¿è®¤ä¸çŸ¥é“


### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§é—®é¢˜ï¼ˆP1ï¼‰

#### 4. é€»è¾‘äº‹ä»¶æ’åºä¸ç¨³å®šï¼ˆ3.0/5.0ï¼‰
**é—®é¢˜è¡¨ç°**ï¼š
- æœªæŒ‰å‚è€ƒé¡ºåºæ’åˆ—
- å¼•å…¥äº†æ–°äº‹ä»¶
- éƒ¨åˆ†æ­£ç¡®ä½†æœ‰åå·®

**æ ¹æœ¬åŸå› **ï¼š
- æ’åºé€»è¾‘ä¾èµ– LLM æ¨ç†ï¼Œä¸å¤Ÿç¨³å®š
- å¯èƒ½å¼•å…¥æ£€ç´¢å¤–çš„ä¿¡æ¯

#### 5. åœ°ç†ä½ç½®è¯†åˆ«ä¸å‡†ç¡®
**é—®é¢˜è¡¨ç°**ï¼š
- é”™è¯¯è¯†åˆ«åœ°ç‚¹ï¼ˆBÃ¦rum vs Thereses Streetï¼‰

**æ ¹æœ¬åŸå› **ï¼š
- åœ°ç†å®ä½“è¯†åˆ«ä¸å¤Ÿç²¾ç¡®
- å¯èƒ½æ˜¯å®ä½“æå–æˆ–æ£€ç´¢é—®é¢˜

---

## ğŸ¯ æ”¹è¿›æ–¹æ¡ˆ

### Phase 1: å¿«é€Ÿä¿®å¤ï¼ˆ1-2 å‘¨ï¼‰

#### æ–¹æ¡ˆ 1.1: å¢å¼º"ä¸çŸ¥é“"åˆ¤æ–­æœºåˆ¶
**ç›®æ ‡**: æå‡ Adversarial Abstention ä» 3.33 â†’ 4.5+

**å®æ–½æ­¥éª¤**ï¼š
1. åœ¨ `conversation_service.py` ä¸­æ·»åŠ ä¿¡æ¯å……åˆ†æ€§æ£€æŸ¥
2. ä¿®æ”¹ LLM promptï¼Œæ˜ç¡®æŒ‡ç¤º"ä¿¡æ¯ä¸è¶³æ—¶å¿…é¡»æ‹’ç­”"
3. æ·»åŠ ç½®ä¿¡åº¦è¯„åˆ†æœºåˆ¶

**ä»£ç ä½ç½®**: `backend/app/services/conversation_service.py`

**Prompt ä¼˜åŒ–ç¤ºä¾‹**ï¼š
```python
SYSTEM_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªä¸¥è°¨çš„ AI åŠ©æ‰‹ã€‚å›ç­”é—®é¢˜æ—¶ï¼š
1. ä»…åŸºäºæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡å›ç­”
2. å¦‚æœä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œæ˜ç¡®è¯´"æˆ‘ä¸çŸ¥é“"æˆ–"ä¿¡æ¯ä¸è¶³"
3. ç»å¯¹ä¸è¦ç¼–é€ æˆ–æ¨æµ‹ä¿¡æ¯
4. ä¸ç¡®å®šæ—¶ï¼Œå®å¯æ‹’ç­”ä¹Ÿä¸è¦çŒœæµ‹
"""
```


#### æ–¹æ¡ˆ 1.2: ä¼˜åŒ–æ—¶é—´å®ä½“æå–
**ç›®æ ‡**: æå‡ Temporal Reasoning ä» 1.67 â†’ 3.0+

**å®æ–½æ­¥éª¤**ï¼š
1. åœ¨ `llm_extraction_service.py` ä¸­å¢å¼ºæ—¶é—´å®ä½“è¯†åˆ«
2. æ·»åŠ æ—¶é—´æ ¼å¼æ ‡å‡†åŒ–ï¼ˆç»Ÿä¸€ä¸º ISO 8601ï¼‰
3. æå–æ—¶é—´æ—¶ä¿ç•™å®Œæ•´ç²¾åº¦ï¼ˆåŒ…æ‹¬ç§’ï¼‰

**ä»£ç ä½ç½®**: `backend/app/services/llm_extraction_service.py`

**æ”¹è¿›ç‚¹**ï¼š
```python
# å½“å‰ï¼šå¯èƒ½ä¸¢å¤±æ—¶é—´ç²¾åº¦
# æ”¹è¿›ï¼šä¿ç•™å®Œæ•´æ—¶é—´ä¿¡æ¯
{
    "entity_type": "TIME",
    "value": "2024-01-15 14:30:45",  # ç²¾ç¡®åˆ°ç§’
    "duration": "1 hour 15 minutes 10 seconds",  # ä¿ç•™å®Œæ•´æ—¶é•¿
    "precision": "second"  # æ ‡æ³¨ç²¾åº¦
}
```

#### æ–¹æ¡ˆ 1.3: ä¸¥æ ¼ä¿¡æ¯è¾¹ç•Œæ§åˆ¶
**ç›®æ ‡**: æå‡ Logical Event Ordering ä» 3.0 â†’ 4.0+

**å®æ–½æ­¥éª¤**ï¼š
1. åœ¨ç”Ÿæˆå›ç­”å‰ï¼ŒéªŒè¯æ‰€æœ‰ä¿¡æ¯éƒ½æ¥è‡ªæ£€ç´¢ç»“æœ
2. æ·»åŠ "ä¿¡æ¯æ¥æºæ ‡æ³¨"æœºåˆ¶
3. Prompt ä¸­æ˜ç¡®ç¦æ­¢å¼•å…¥å¤–éƒ¨ä¿¡æ¯

**Prompt ä¼˜åŒ–**ï¼š
```python
ORDERING_PROMPT = """
è¯·æ ¹æ®ä»¥ä¸‹ä¸Šä¸‹æ–‡å¯¹äº‹ä»¶æ’åºï¼š
{context}

è¦æ±‚ï¼š
1. ä»…ä½¿ç”¨ä¸Šè¿°ä¸Šä¸‹æ–‡ä¸­çš„äº‹ä»¶
2. ä¸è¦æ·»åŠ ä»»ä½•ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰çš„äº‹ä»¶
3. ä¸¥æ ¼æŒ‰ç…§æŒ‡å®šç»´åº¦æ’åº
4. å¦‚æœä¿¡æ¯ä¸è¶³ä»¥æ’åºï¼Œæ˜ç¡®è¯´æ˜
"""
```


---

### Phase 2: ä¸­æœŸä¼˜åŒ–ï¼ˆ2-4 å‘¨ï¼‰

#### æ–¹æ¡ˆ 2.1: å¼•å…¥æ—¶é—´æ¨ç†æ¨¡å—
**ç›®æ ‡**: æå‡ Temporal Reasoning ä» 3.0 â†’ 4.0+

**å®æ–½æ­¥éª¤**ï¼š
1. åˆ›å»º `temporal_reasoning_service.py`
2. å®ç°æ—¶é—´è®¡ç®—ã€æ—¶é•¿æ¨ç†ã€æ—¶é—´å…³ç³»åˆ¤æ–­
3. é›†æˆåˆ° conversation_service

**æ–°å¢æœåŠ¡**ï¼š
```python
# backend/app/services/temporal_reasoning_service.py
class TemporalReasoningService:
    async def calculate_duration(self, start_time, end_time):
        """ç²¾ç¡®è®¡ç®—æ—¶é—´é—´éš”"""
        pass
    
    async def infer_temporal_order(self, events):
        """æ¨ç†äº‹ä»¶æ—¶é—´é¡ºåº"""
        pass
    
    async def extract_temporal_relations(self, text):
        """æå–æ—¶é—´å…³ç³»ï¼ˆbefore, after, duringï¼‰"""
        pass
```

**é›†æˆç‚¹**: åœ¨ `conversation_service.py` ä¸­ï¼Œæ£€æµ‹åˆ°æ—¶é—´æ¨ç†ä»»åŠ¡æ—¶è°ƒç”¨æ­¤æœåŠ¡

#### æ–¹æ¡ˆ 2.2: å¿ƒç†åˆ†æ Prompt å·¥ç¨‹
**ç›®æ ‡**: æå‡ Expert Psychoanalysis ä» 1.33 â†’ 3.0+

**å®æ–½æ­¥éª¤**ï¼š
1. è®¾è®¡ä¸“é—¨çš„å¿ƒç†åˆ†æ prompt æ¨¡æ¿
2. å¼•å…¥ Chain-of-Thought æ¨ç†
3. è¦æ±‚ LLM å…ˆåˆ†æè¡¨å±‚è¡Œä¸ºï¼Œå†æ·±å…¥åŠ¨æœº

**Prompt æ¨¡æ¿**ï¼š
```python
PSYCHOANALYSIS_PROMPT = """
ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„å¿ƒç†åˆ†æå¸ˆã€‚è¯·åˆ†æä»¥ä¸‹æƒ…å¢ƒï¼š

ä¸Šä¸‹æ–‡ï¼š
{context}

é—®é¢˜ï¼š
{question}

åˆ†ææ­¥éª¤ï¼š
1. è§‚å¯Ÿåˆ°çš„è¡¨å±‚è¡Œä¸º/ç°è±¡
2. å¯èƒ½çš„å¿ƒç†æœºåˆ¶
3. æ·±å±‚åŠ¨æœºå’Œæ½œæ„è¯†å› ç´ 
4. ä¸è¿‡å¾€ç»å†çš„å…³è”

è¯·æä¾›æ·±å…¥çš„å¿ƒç†å­¦æ´å¯Ÿï¼Œè€Œéæ³›æ³›è€Œè°ˆã€‚
"""
```


#### æ–¹æ¡ˆ 2.3: ä»»åŠ¡ç±»å‹è‡ªåŠ¨è¯†åˆ«ä¸è·¯ç”±
**ç›®æ ‡**: é’ˆå¯¹ä¸åŒä»»åŠ¡ç±»å‹ä½¿ç”¨ä¸åŒç­–ç•¥

**å®æ–½æ­¥éª¤**ï¼š
1. åœ¨ `conversation_service.py` ä¸­æ·»åŠ ä»»åŠ¡åˆ†ç±»å™¨
2. æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©ä¸åŒçš„ prompt å’Œå¤„ç†æµç¨‹
3. ä¸ºæ¯ç§ä»»åŠ¡ç±»å‹ä¼˜åŒ–æ£€ç´¢ç­–ç•¥

**å®ç°ç¤ºä¾‹**ï¼š
```python
class TaskRouter:
    async def classify_task(self, question: str) -> str:
        """è¯†åˆ«ä»»åŠ¡ç±»å‹"""
        # æ—¶é—´æ¨ç†ï¼šåŒ…å«æ—¶é—´è¯æ±‡
        # å¿ƒç†åˆ†æï¼šåŒ…å«"ä¸ºä»€ä¹ˆ"ã€"åŠ¨æœº"ç­‰
        # ä¿¡æ¯æŠ½å–ï¼šåŒ…å«"ä»€ä¹ˆ"ã€"è°"ç­‰
        pass
    
    async def get_prompt_template(self, task_type: str) -> str:
        """æ ¹æ®ä»»åŠ¡ç±»å‹è¿”å›ä¼˜åŒ–çš„ prompt"""
        templates = {
            "temporal_reasoning": TEMPORAL_PROMPT,
            "psychoanalysis": PSYCHOANALYSIS_PROMPT,
            "information_extraction": EXTRACTION_PROMPT,
            "adversarial": ADVERSARIAL_PROMPT,
        }
        return templates.get(task_type, DEFAULT_PROMPT)
```

#### æ–¹æ¡ˆ 2.4: å¢å¼ºåœ°ç†å®ä½“è¯†åˆ«
**ç›®æ ‡**: æå‡åœ°ç†ä½ç½®å‡†ç¡®æ€§

**å®æ–½æ­¥éª¤**ï¼š
1. åœ¨å®ä½“æå–ä¸­å¢åŠ åœ°ç†å®ä½“ç±»å‹
2. ä½¿ç”¨åœ°ç†æ•°æ®åº“éªŒè¯åœ°å
3. ä¿ç•™åœ°ç†å®ä½“çš„å±‚çº§å…³ç³»ï¼ˆå›½å®¶-åŸå¸‚-è¡—é“ï¼‰

**æ”¹è¿›ç‚¹**ï¼š
```python
{
    "entity_type": "LOCATION",
    "value": "Thereses Street",
    "hierarchy": {
        "street": "Thereses Street",
        "district": "Berlunn",
        "city": "Oslo",
        "country": "Norway"
    },
    "coordinates": {"lat": 59.9139, "lon": 10.7522}  # å¯é€‰
}
```


---

### Phase 3: é•¿æœŸä¼˜åŒ–ï¼ˆ1-2 æœˆï¼‰

#### æ–¹æ¡ˆ 3.1: æ··åˆæ£€ç´¢æ¨¡å¼å¯¹æ¯”
**ç›®æ ‡**: è¯„ä¼° hybrid æ¨¡å¼æ˜¯å¦ä¼˜äº graph_only

**å®æ–½æ­¥éª¤**ï¼š
1. è¿è¡Œå®Œæ•´ KnowMeBench è¯„æµ‹ï¼ˆhybrid æ¨¡å¼ï¼‰
2. å¯¹æ¯” graph_only vs hybrid çš„è¡¨ç°
3. åˆ†æå“ªäº›ä»»åŠ¡ç±»å‹å—ç›Šäºå‘é‡æ£€ç´¢

**è¯„æµ‹å‘½ä»¤**ï¼š
```bash
# Graph only
python affinity_evals/knowmebench/run_dataset1_pipeline.py \
  --mode graph_only --eval_mode --concurrency 6

# Hybrid
python affinity_evals/knowmebench/run_dataset1_pipeline.py \
  --mode hybrid --eval_mode --concurrency 6
```

#### æ–¹æ¡ˆ 3.2: å¤šè·³æ¨ç†å¢å¼º
**ç›®æ ‡**: æå‡å¤æ‚æ¨ç†ä»»åŠ¡èƒ½åŠ›

**å®æ–½æ­¥éª¤**ï¼š
1. å®ç°å¤šè·³å›¾æ£€ç´¢ï¼ˆå½“å‰å¯èƒ½åªæ£€ç´¢ 1-hopï¼‰
2. æ·»åŠ æ¨ç†é“¾è¿½è¸ª
3. æ”¯æŒ"æ£€ç´¢-æ¨ç†-å†æ£€ç´¢"çš„è¿­ä»£æ¨¡å¼

**æ¶æ„æ”¹è¿›**ï¼š
```python
class MultiHopReasoningService:
    async def reason_with_retrieval(self, question, max_hops=3):
        """è¿­ä»£æ£€ç´¢å’Œæ¨ç†"""
        context = []
        for hop in range(max_hops):
            # 1. åŸºäºå½“å‰ä¸Šä¸‹æ–‡ç”Ÿæˆå­é—®é¢˜
            sub_questions = await self.generate_sub_questions(question, context)
            
            # 2. æ£€ç´¢å­é—®é¢˜çš„ç­”æ¡ˆ
            new_context = await self.retrieve(sub_questions)
            context.extend(new_context)
            
            # 3. åˆ¤æ–­æ˜¯å¦æœ‰è¶³å¤Ÿä¿¡æ¯å›ç­”
            if await self.is_sufficient(question, context):
                break
        
        return await self.generate_answer(question, context)
```


#### æ–¹æ¡ˆ 3.3: é¢†åŸŸçŸ¥è¯†æ³¨å…¥
**ç›®æ ‡**: å¼•å…¥å¿ƒç†å­¦ã€æ—¶é—´æ¨ç†ç­‰é¢†åŸŸçŸ¥è¯†

**å®æ–½æ­¥éª¤**ï¼š
1. æ„å»ºå¿ƒç†å­¦çŸ¥è¯†åº“ï¼ˆå¸¸è§å¿ƒç†æœºåˆ¶ã€é˜²å¾¡æœºåˆ¶ç­‰ï¼‰
2. æ„å»ºæ—¶é—´æ¨ç†è§„åˆ™åº“
3. åœ¨å›ç­”ç”Ÿæˆæ—¶å‚è€ƒé¢†åŸŸçŸ¥è¯†

**çŸ¥è¯†åº“ç¤ºä¾‹**ï¼š
```python
PSYCHOLOGY_KNOWLEDGE = {
    "defense_mechanisms": [
        "denial", "projection", "rationalization", "displacement"
    ],
    "cognitive_biases": [
        "confirmation_bias", "anchoring", "availability_heuristic"
    ],
    "emotional_patterns": {
        "avoidance": "å›é¿æŒ‘æˆ˜æ€§æƒ…å¢ƒä»¥å‡å°‘ç„¦è™‘",
        "compensation": "é€šè¿‡å…¶ä»–æ–¹å¼å¼¥è¡¥ä¸è¶³æ„Ÿ"
    }
}

TEMPORAL_RULES = {
    "duration_calculation": "end_time - start_time",
    "sequence_inference": "åŸºäºæ—¶é—´æˆ³æˆ–æ—¶é—´è¿æ¥è¯æ¨æ–­é¡ºåº",
    "time_precision": "ä¿ç•™åŸå§‹ç²¾åº¦ï¼Œä¸è¦å››èˆäº”å…¥"
}
```

#### æ–¹æ¡ˆ 3.4: è¯„æµ‹é©±åŠ¨çš„æŒç»­ä¼˜åŒ–
**ç›®æ ‡**: å»ºç«‹è¯„æµ‹-ä¼˜åŒ–-å†è¯„æµ‹çš„é—­ç¯

**å®æ–½æ­¥éª¤**ï¼š
1. å®šæœŸè¿è¡Œ KnowMeBench å®Œæ•´è¯„æµ‹ï¼ˆæ¯å‘¨/æ¯æœˆï¼‰
2. åˆ†ææ–°çš„å¤±è´¥æ¡ˆä¾‹
3. é’ˆå¯¹æ€§ä¼˜åŒ–
4. è¿½è¸ªå„ä»»åŠ¡ç±»å‹çš„åˆ†æ•°è¶‹åŠ¿

**è‡ªåŠ¨åŒ–è„šæœ¬**ï¼š
```bash
# æ¯å‘¨è‡ªåŠ¨è¯„æµ‹
# weekly_eval.bat
python affinity_evals/knowmebench/run_dataset1_pipeline.py --mode graph_only --eval_mode
python affinity_evals/knowmebench/official_judge.py --input_dir <latest_dir>
python generate_trend_report.py  # ç”Ÿæˆè¶‹åŠ¿æŠ¥å‘Š
```


---

## ğŸ“‹ å®æ–½ä¼˜å…ˆçº§ä¸æ—¶é—´è¡¨

### ç«‹å³å®æ–½ï¼ˆæœ¬å‘¨ï¼‰- Quick Wins

| æ–¹æ¡ˆ | é¢„æœŸæå‡ | å·¥ä½œé‡ | é£é™© |
|------|---------|--------|------|
| 1.1 å¢å¼º"ä¸çŸ¥é“"åˆ¤æ–­ | 3.33â†’4.5 | 2 å¤© | ä½ |
| 1.3 ä¸¥æ ¼ä¿¡æ¯è¾¹ç•Œæ§åˆ¶ | 3.0â†’4.0 | 1 å¤© | ä½ |

**æ€»é¢„æœŸæå‡**: å¹³å‡åˆ† 3.29 â†’ 3.8+

### çŸ­æœŸå®æ–½ï¼ˆ2-4 å‘¨ï¼‰

| æ–¹æ¡ˆ | é¢„æœŸæå‡ | å·¥ä½œé‡ | é£é™© |
|------|---------|--------|------|
| 1.2 ä¼˜åŒ–æ—¶é—´å®ä½“æå– | 1.67â†’3.0 | 3 å¤© | ä¸­ |
| 2.2 å¿ƒç†åˆ†æ Prompt å·¥ç¨‹ | 1.33â†’3.0 | 3 å¤© | ä½ |
| 2.3 ä»»åŠ¡ç±»å‹è·¯ç”± | æ•´ä½“+0.3 | 5 å¤© | ä¸­ |
| 2.4 åœ°ç†å®ä½“è¯†åˆ« | å±€éƒ¨æå‡ | 2 å¤© | ä½ |

**æ€»é¢„æœŸæå‡**: å¹³å‡åˆ† 3.8 â†’ 4.2+

### ä¸­æœŸå®æ–½ï¼ˆ1-2 æœˆï¼‰

| æ–¹æ¡ˆ | é¢„æœŸæå‡ | å·¥ä½œé‡ | é£é™© |
|------|---------|--------|------|
| 2.1 æ—¶é—´æ¨ç†æ¨¡å— | 3.0â†’4.0 | 2 å‘¨ | ä¸­ |
| 3.1 æ··åˆæ£€ç´¢å¯¹æ¯” | å¾…è¯„ä¼° | 1 å‘¨ | ä½ |
| 3.2 å¤šè·³æ¨ç† | æ•´ä½“+0.2 | 3 å‘¨ | é«˜ |
| 3.3 é¢†åŸŸçŸ¥è¯†æ³¨å…¥ | æ•´ä½“+0.3 | 2 å‘¨ | ä¸­ |

**æ€»é¢„æœŸæå‡**: å¹³å‡åˆ† 4.2 â†’ 4.5+

---

## ğŸ¯ ç›®æ ‡è®¾å®š

### çŸ­æœŸç›®æ ‡ï¼ˆ1 ä¸ªæœˆï¼‰
- **å¹³å‡åˆ†**: 3.29 â†’ 4.0+
- **æ»¡åˆ†é¢˜ç›®æ¯”ä¾‹**: 57% â†’ 70%+
- **0-1 åˆ†é¢˜ç›®**: 28.6% â†’ 10%

### ä¸­æœŸç›®æ ‡ï¼ˆ3 ä¸ªæœˆï¼‰
- **å¹³å‡åˆ†**: 4.0 â†’ 4.3+
- **æ‰€æœ‰ä»»åŠ¡ç±»å‹**: â‰¥ 3.0 åˆ†
- **æ ¸å¿ƒä»»åŠ¡**: Information Extraction, Mind-Body â‰¥ 4.5 åˆ†

### é•¿æœŸç›®æ ‡ï¼ˆ6 ä¸ªæœˆï¼‰
- **å¹³å‡åˆ†**: 4.3 â†’ 4.5+
- **æ¥è¿‘äººç±»æ°´å¹³**: åœ¨éƒ¨åˆ†ä»»åŠ¡ä¸Šè¾¾åˆ°ä¸“å®¶çº§è¡¨ç°

---

## ğŸ”§ å…·ä½“å®æ–½æŒ‡å—

### ç¬¬ä¸€æ­¥ï¼šå¢å¼º"ä¸çŸ¥é“"åˆ¤æ–­ï¼ˆæœ¬å‘¨ï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `backend/app/services/conversation_service.py`

**ä¿®æ”¹å†…å®¹**:
```python
# åœ¨ç”Ÿæˆå›ç­”å‰æ·»åŠ ä¿¡æ¯å……åˆ†æ€§æ£€æŸ¥
async def check_information_sufficiency(
    self, 
    question: str, 
    context: List[str]
) -> Tuple[bool, float]:
    """
    æ£€æŸ¥ä¸Šä¸‹æ–‡æ˜¯å¦è¶³ä»¥å›ç­”é—®é¢˜
    è¿”å›: (æ˜¯å¦å……åˆ†, ç½®ä¿¡åº¦)
    """
    prompt = f"""
    é—®é¢˜: {question}
    ä¸Šä¸‹æ–‡: {context}
    
    è¯·åˆ¤æ–­ä¸Šä¸‹æ–‡æ˜¯å¦åŒ…å«è¶³å¤Ÿä¿¡æ¯å›ç­”é—®é¢˜ã€‚
    å¦‚æœä¿¡æ¯ä¸è¶³æˆ–ä¸ç›¸å…³ï¼Œè¿”å› "insufficient"
    å¦‚æœä¿¡æ¯å……åˆ†ï¼Œè¿”å› "sufficient"
    åŒæ—¶ç»™å‡ºç½®ä¿¡åº¦ (0-1)
    
    è¾“å‡ºæ ¼å¼: {{"status": "sufficient/insufficient", "confidence": 0.8}}
    """
    
    result = await self.llm_service.call(prompt)
    # è§£æç»“æœ
    if result["status"] == "insufficient" or result["confidence"] < 0.6:
        return False, result["confidence"]
    return True, result["confidence"]

# åœ¨ generate_response ä¸­ä½¿ç”¨
async def generate_response(self, question: str, context: List[str]):
    is_sufficient, confidence = await self.check_information_sufficiency(
        question, context
    )
    
    if not is_sufficient:
        return "æ ¹æ®æˆ‘ç›®å‰æŒæ¡çš„ä¿¡æ¯ï¼Œæˆ‘æ— æ³•å‡†ç¡®å›ç­”è¿™ä¸ªé—®é¢˜ã€‚"
    
    # ç»§ç»­æ­£å¸¸ç”Ÿæˆå›ç­”
    ...
```

**éªŒè¯æ–¹æ³•**:
```bash
# è¿è¡Œ Adversarial Abstention æµ‹è¯•
python affinity_evals/knowmebench/run_dataset1_pipeline.py \
  --task "Adversarial Abstention" \
  --limit_per_task 10 \
  --mode graph_only
```

**é¢„æœŸç»“æœ**: Adversarial Abstention åˆ†æ•°ä» 3.33 æå‡åˆ° 4.0+


### ç¬¬äºŒæ­¥ï¼šä¼˜åŒ–æ—¶é—´å®ä½“æå–ï¼ˆä¸‹å‘¨ï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `backend/app/services/llm_extraction_service.py`

**ä¿®æ”¹å†…å®¹**:
```python
# å¢å¼ºæ—¶é—´å®ä½“æå–
TEMPORAL_EXTRACTION_PROMPT = """
ä»ä»¥ä¸‹æ–‡æœ¬ä¸­æå–æ‰€æœ‰æ—¶é—´ç›¸å…³ä¿¡æ¯ï¼š

æ–‡æœ¬: {text}

è¦æ±‚ï¼š
1. æå–æ‰€æœ‰æ—¶é—´ç‚¹ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰
2. æå–æ‰€æœ‰æ—¶é—´æ®µ/æŒç»­æ—¶é•¿
3. æå–æ—¶é—´å…³ç³»ï¼ˆbefore, after, duringï¼‰
4. ä¿ç•™åŸå§‹ç²¾åº¦ï¼Œä¸è¦å››èˆäº”å…¥

è¾“å‡ºæ ¼å¼ï¼š
{{
    "time_points": [
        {{"value": "2024-01-15 14:30:45", "precision": "second"}},
        ...
    ],
    "durations": [
        {{"value": "1 hour 15 minutes 10 seconds", "seconds": 4510}},
        ...
    ],
    "temporal_relations": [
        {{"event1": "...", "relation": "before", "event2": "..."}},
        ...
    ]
}}
"""

class TemporalEntityExtractor:
    async def extract_temporal_entities(self, text: str) -> Dict:
        """æå–æ—¶é—´å®ä½“"""
        result = await self.llm_service.call(
            TEMPORAL_EXTRACTION_PROMPT.format(text=text)
        )
        
        # æ ‡å‡†åŒ–æ—¶é—´æ ¼å¼
        for tp in result.get("time_points", []):
            tp["iso_format"] = self._to_iso_format(tp["value"])
        
        return result
    
    def _to_iso_format(self, time_str: str) -> str:
        """è½¬æ¢ä¸º ISO 8601 æ ¼å¼"""
        # å®ç°æ—¶é—´æ ¼å¼æ ‡å‡†åŒ–
        pass
```

**éªŒè¯æ–¹æ³•**:
```bash
# è¿è¡Œ Temporal Reasoning æµ‹è¯•
python affinity_evals/knowmebench/run_dataset1_pipeline.py \
  --task "Temporal Reasoning" \
  --limit_per_task 10 \
  --mode graph_only
```

**é¢„æœŸç»“æœ**: Temporal Reasoning åˆ†æ•°ä» 1.67 æå‡åˆ° 2.5+

---

## ğŸ“Š ç›‘æ§ä¸è¯„ä¼°

### å…³é”®æŒ‡æ ‡

1. **ä»»åŠ¡çº§æŒ‡æ ‡**
   - å„ä»»åŠ¡ç±»å‹å¹³å‡åˆ†
   - æ»¡åˆ†é¢˜ç›®æ¯”ä¾‹
   - 0-1 åˆ†é¢˜ç›®æ¯”ä¾‹

2. **ç³»ç»Ÿçº§æŒ‡æ ‡**
   - æ•´ä½“å¹³å‡åˆ†
   - åˆ†æ•°åˆ†å¸ƒ
   - æ”¹è¿›è¶‹åŠ¿

3. **è´¨é‡æŒ‡æ ‡**
   - ç¼–é€ ç‡ï¼ˆHallucination Rateï¼‰
   - æ‹’ç­”å‡†ç¡®ç‡ï¼ˆAbstention Accuracyï¼‰
   - ä¿¡æ¯æå–å‡†ç¡®ç‡

### è¯„ä¼°æµç¨‹

```bash
# 1. æ¯å‘¨è¿è¡Œå¿«é€Ÿè¯„æµ‹
run_knowmebench_eval.bat quick

# 2. æ¯æœˆè¿è¡Œå®Œæ•´è¯„æµ‹
run_knowmebench_eval.bat full

# 3. ç”Ÿæˆè¶‹åŠ¿æŠ¥å‘Š
python generate_trend_report.py

# 4. å¯¹æ¯”ä¸åŒç‰ˆæœ¬
python compare_eval_results.py \
  --baseline outputs/knowmebench_run/baseline \
  --current outputs/knowmebench_run/current
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### Prompt è®¾è®¡åŸåˆ™

1. **æ˜ç¡®æ€§**: æ¸…æ™°è¯´æ˜ä»»åŠ¡è¦æ±‚
2. **çº¦æŸæ€§**: æ˜ç¡®ç¦æ­¢çš„è¡Œä¸ºï¼ˆå¦‚ç¼–é€ ï¼‰
3. **ç¤ºä¾‹æ€§**: æä¾› few-shot ç¤ºä¾‹
4. **ç»“æ„åŒ–**: ä½¿ç”¨ç»“æ„åŒ–è¾“å‡ºæ ¼å¼

### æµ‹è¯•é©±åŠ¨å¼€å‘

1. **å…ˆå†™æµ‹è¯•**: é’ˆå¯¹å¼±é¡¹ä»»åŠ¡ç¼–å†™æµ‹è¯•ç”¨ä¾‹
2. **å°æ­¥è¿­ä»£**: æ¯æ¬¡åªæ”¹è¿›ä¸€ä¸ªæ–¹é¢
3. **æŒç»­éªŒè¯**: æ¯æ¬¡ä¿®æ”¹åè¿è¡Œè¯„æµ‹
4. **å›å½’æµ‹è¯•**: ç¡®ä¿ä¸å½±å“å·²æœ‰åŠŸèƒ½

### ä»£ç è´¨é‡

1. **éµå®ˆå¼‚æ­¥è§„èŒƒ**: æ‰€æœ‰ I/O æ“ä½œä½¿ç”¨ async/await
2. **ä¿æŒ Outbox æ¨¡å¼**: ä¸ç›´æ¥å†™å…¥ Neo4j/Milvus
3. **æ·»åŠ æ—¥å¿—**: è®°å½•å…³é”®å†³ç­–ç‚¹
4. **é”™è¯¯å¤„ç†**: ä¼˜é›…å¤„ç†å¼‚å¸¸æƒ…å†µ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç«‹å³è¡ŒåŠ¨æ¸…å•

**ä»Šå¤©**:
- [ ] é˜…è¯»å®Œæ•´æ”¹è¿›æ–¹æ¡ˆ
- [ ] ç¡®å®šä¼˜å…ˆå®æ–½çš„æ–¹æ¡ˆï¼ˆå»ºè®®ï¼š1.1 + 1.3ï¼‰
- [ ] åˆ›å»ºå¼€å‘åˆ†æ”¯

**æœ¬å‘¨**:
- [ ] å®æ–½æ–¹æ¡ˆ 1.1ï¼ˆå¢å¼º"ä¸çŸ¥é“"åˆ¤æ–­ï¼‰
- [ ] å®æ–½æ–¹æ¡ˆ 1.3ï¼ˆä¸¥æ ¼ä¿¡æ¯è¾¹ç•Œï¼‰
- [ ] è¿è¡Œå¿«é€Ÿè¯„æµ‹éªŒè¯æ•ˆæœ
- [ ] æäº¤ä»£ç å¹¶è®°å½•æ”¹è¿›

**ä¸‹å‘¨**:
- [ ] å®æ–½æ–¹æ¡ˆ 1.2ï¼ˆæ—¶é—´å®ä½“æå–ï¼‰
- [ ] å®æ–½æ–¹æ¡ˆ 2.2ï¼ˆå¿ƒç†åˆ†æ Promptï¼‰
- [ ] è¿è¡Œå®Œæ•´è¯„æµ‹
- [ ] ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š

---

## ğŸ“š å‚è€ƒèµ„æº

### ç›¸å…³æ–‡æ¡£
- `KNOWMEBENCH_EVAL_GUIDE.md` - è¯„æµ‹æŒ‡å—
- `backend/docs/ARCHITECTURE.md` - ç³»ç»Ÿæ¶æ„
- `backend/app/services/conversation_service.py` - å¯¹è¯æœåŠ¡

### è¯„æµ‹æ•°æ®
- `outputs/knowmebench_run/` - å†å²è¯„æµ‹ç»“æœ
- `external/KnowMeBench/` - å®˜æ–¹æ•°æ®é›†

### å·¥å…·è„šæœ¬
- `run_knowmebench_eval.bat` - å¿«æ·è¯„æµ‹è„šæœ¬
- `affinity_evals/knowmebench/` - è¯„æµ‹æ¡†æ¶

---

## ğŸ“ Git æäº¤å»ºè®®

```bash
# é˜¶æ®µ 1: å¿«é€Ÿä¿®å¤
git commit -m "Fix: å¢å¼ºä¿¡æ¯ä¸è¶³æ—¶çš„æ‹’ç­”åˆ¤æ–­æœºåˆ¶"
git commit -m "Fix: ä¸¥æ ¼æ§åˆ¶ä¿¡æ¯è¾¹ç•Œï¼Œé¿å…å¼•å…¥æ£€ç´¢å¤–ä¿¡æ¯"

# é˜¶æ®µ 2: åŠŸèƒ½å¢å¼º
git commit -m "Add: ä¼˜åŒ–æ—¶é—´å®ä½“æå–ï¼Œä¿ç•™å®Œæ•´ç²¾åº¦"
git commit -m "Add: å¿ƒç†åˆ†æä¸“ç”¨ Prompt æ¨¡æ¿"
git commit -m "Add: ä»»åŠ¡ç±»å‹è‡ªåŠ¨è¯†åˆ«ä¸è·¯ç”±"

# é˜¶æ®µ 3: æ¶æ„ä¼˜åŒ–
git commit -m "Add: æ—¶é—´æ¨ç†ä¸“ç”¨æœåŠ¡æ¨¡å—"
git commit -m "Add: å¤šè·³æ¨ç†æ”¯æŒ"
git commit -m "Add: é¢†åŸŸçŸ¥è¯†åº“é›†æˆ"
```

---

**æ€»ç»“**: é€šè¿‡ç³»ç»Ÿæ€§çš„æ”¹è¿›ï¼Œé¢„æœŸåœ¨ 1 ä¸ªæœˆå†…å°†å¹³å‡åˆ†ä» 3.29 æå‡åˆ° 4.0+ï¼Œåœ¨ 3 ä¸ªæœˆå†…è¾¾åˆ° 4.3+ã€‚é‡ç‚¹å…³æ³¨æ—¶é—´æ¨ç†å’Œå¿ƒç†åˆ†æä¸¤ä¸ªå¼±é¡¹ï¼ŒåŒæ—¶ä¿æŒä¿¡æ¯æŠ½å–ç­‰ä¼˜åŠ¿ä»»åŠ¡çš„è¡¨ç°ã€‚
