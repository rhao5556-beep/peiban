<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard API æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #45a049;
        }
        button.delete {
            background: #f44336;
        }
        button.delete:hover {
            background: #da190b;
        }
        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Dashboard API åŠŸèƒ½æµ‹è¯•</h1>
    <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•æ–°æ·»åŠ çš„ 5 ä¸ª API æ–¹æ³•ï¼ˆMock æ¨¡å¼ï¼‰</p>

    <div class="test-section">
        <h2>1. getDashboard() - è·å–ä»ªè¡¨ç›˜æ•°æ®</h2>
        <button onclick="testGetDashboard()">æµ‹è¯• getDashboard</button>
        <div id="dashboard-result"></div>
    </div>

    <div class="test-section">
        <h2>2. getMemories(limit) - è·å–è®°å¿†åˆ—è¡¨</h2>
        <button onclick="testGetMemories()">æµ‹è¯• getMemories(50)</button>
        <div id="memories-result"></div>
    </div>

    <div class="test-section">
        <h2>3. getMemory(id) - è·å–å•æ¡è®°å¿†è¯¦æƒ…</h2>
        <button onclick="testGetMemory()">æµ‹è¯• getMemory('mem_1')</button>
        <div id="memory-result"></div>
    </div>

    <div class="test-section">
        <h2>4. deleteMemories(ids) - æ‰¹é‡åˆ é™¤è®°å¿†</h2>
        <button class="delete" onclick="testDeleteMemories()">æµ‹è¯• deleteMemories(['mem_1', 'mem_2'])</button>
        <div id="delete-memories-result"></div>
    </div>

    <div class="test-section">
        <h2>5. deleteAllMemories() - åˆ é™¤å…¨éƒ¨è®°å¿†</h2>
        <button class="delete" onclick="testDeleteAllMemories()">æµ‹è¯• deleteAllMemories()</button>
        <div id="delete-all-result"></div>
    </div>

    <script type="module">
        // æ¨¡æ‹Ÿ api.ts ä¸­çš„æ–¹æ³•ï¼ˆç®€åŒ–ç‰ˆï¼Œä»…ç”¨äºæµ‹è¯•ï¼‰
        const USE_MOCK_DATA = true;

        window.api = {
            getDashboard: async () => {
                if (USE_MOCK_DATA) {
                    await new Promise(resolve => setTimeout(resolve, 300));
                    return {
                        relationship: {
                            state: 'friend',
                            state_display: 'æœ‹å‹',
                            score: 0.55,
                            score_raw: 0.55,
                            hearts: 'ğŸ’™ğŸ’™ğŸ’™'
                        },
                        days_known: 30,
                        memories: { count: 15, can_view_details: true },
                        top_topics: [
                            { topic: 'ç¼–ç¨‹', count: 8 },
                            { topic: 'å’–å•¡', count: 5 },
                            { topic: 'AI', count: 3 }
                        ],
                        emotion_trend: [
                            { date: 'ç¬¬1å¤©', score: 10 },
                            { date: 'ç¬¬15å¤©', score: 35 },
                            { date: 'ç¬¬30å¤©', score: 55 }
                        ],
                        feedback: { likes: 12, dislikes: 2, saves: 5, favorites: 5 },
                        health_reminder: null
                    };
                }
            },

            getMemories: async (limit) => {
                if (USE_MOCK_DATA) {
                    await new Promise(resolve => setTimeout(resolve, 300));
                    return [
                        {
                            id: 'mem_1',
                            content: 'å°æ˜å–œæ¬¢å–å’–å•¡',
                            valence: 0.8,
                            status: 'committed',
                            created_at: new Date(Date.now() - 86400000 * 29).toISOString(),
                            committed_at: new Date(Date.now() - 86400000 * 29).toISOString()
                        },
                        {
                            id: 'mem_2',
                            content: 'å°æ˜æ˜¯ä¸€åç¨‹åºå‘˜',
                            valence: 0.6,
                            status: 'committed',
                            created_at: new Date(Date.now() - 86400000 * 28).toISOString(),
                            committed_at: new Date(Date.now() - 86400000 * 28).toISOString()
                        },
                        {
                            id: 'mem_3',
                            content: 'å°æ˜ç»å¸¸æ·±å¤œå·¥ä½œ',
                            valence: -0.2,
                            status: 'committed',
                            created_at: new Date(Date.now() - 86400000 * 15).toISOString(),
                            committed_at: new Date(Date.now() - 86400000 * 15).toISOString()
                        }
                    ];
                }
            },

            getMemory: async (memoryId) => {
                if (USE_MOCK_DATA) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    return {
                        id: memoryId,
                        content: 'è¿™æ˜¯ä¸€æ¡è¯¦ç»†çš„è®°å¿†å†…å®¹',
                        valence: 0.7,
                        status: 'committed',
                        created_at: new Date(Date.now() - 86400000).toISOString(),
                        committed_at: new Date(Date.now() - 86400000).toISOString()
                    };
                }
            },

            deleteMemories: async (memoryIds) => {
                if (USE_MOCK_DATA) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    console.log('Mock: Deleted memories', memoryIds);
                    return;
                }
            },

            deleteAllMemories: async () => {
                if (USE_MOCK_DATA) {
                    await new Promise(resolve => setTimeout(resolve, 800));
                    console.log('Mock: Deleted all memories');
                    return;
                }
            }
        };

        window.testGetDashboard = async () => {
            const resultDiv = document.getElementById('dashboard-result');
            resultDiv.innerHTML = '<p>æµ‹è¯•ä¸­...</p>';
            try {
                const result = await window.api.getDashboard();
                resultDiv.innerHTML = `
                    <p class="success">âœ“ æµ‹è¯•æˆåŠŸ</p>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (e) {
                resultDiv.innerHTML = `<p class="error">âœ— æµ‹è¯•å¤±è´¥: ${e.message}</p>`;
            }
        };

        window.testGetMemories = async () => {
            const resultDiv = document.getElementById('memories-result');
            resultDiv.innerHTML = '<p>æµ‹è¯•ä¸­...</p>';
            try {
                const result = await window.api.getMemories(50);
                resultDiv.innerHTML = `
                    <p class="success">âœ“ æµ‹è¯•æˆåŠŸ (è¿”å› ${result.length} æ¡è®°å¿†)</p>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (e) {
                resultDiv.innerHTML = `<p class="error">âœ— æµ‹è¯•å¤±è´¥: ${e.message}</p>`;
            }
        };

        window.testGetMemory = async () => {
            const resultDiv = document.getElementById('memory-result');
            resultDiv.innerHTML = '<p>æµ‹è¯•ä¸­...</p>';
            try {
                const result = await window.api.getMemory('mem_1');
                resultDiv.innerHTML = `
                    <p class="success">âœ“ æµ‹è¯•æˆåŠŸ</p>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (e) {
                resultDiv.innerHTML = `<p class="error">âœ— æµ‹è¯•å¤±è´¥: ${e.message}</p>`;
            }
        };

        window.testDeleteMemories = async () => {
            const resultDiv = document.getElementById('delete-memories-result');
            resultDiv.innerHTML = '<p>æµ‹è¯•ä¸­...</p>';
            try {
                await window.api.deleteMemories(['mem_1', 'mem_2']);
                resultDiv.innerHTML = `<p class="success">âœ“ æµ‹è¯•æˆåŠŸ (å·²åˆ é™¤ 2 æ¡è®°å¿†)</p>`;
            } catch (e) {
                resultDiv.innerHTML = `<p class="error">âœ— æµ‹è¯•å¤±è´¥: ${e.message}</p>`;
            }
        };

        window.testDeleteAllMemories = async () => {
            const resultDiv = document.getElementById('delete-all-result');
            resultDiv.innerHTML = '<p>æµ‹è¯•ä¸­...</p>';
            try {
                await window.api.deleteAllMemories();
                resultDiv.innerHTML = `<p class="success">âœ“ æµ‹è¯•æˆåŠŸ (å·²åˆ é™¤å…¨éƒ¨è®°å¿†)</p>`;
            } catch (e) {
                resultDiv.innerHTML = `<p class="error">âœ— æµ‹è¯•å¤±è´¥: ${e.message}</p>`;
            }
        };
    </script>
</body>
</html>
